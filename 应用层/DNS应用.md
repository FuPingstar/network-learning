##### DNS域名系统

##### 概述

1. Internet上主机/路由器的识别问题
   + 域名和IP地址之间如何映射？
2. 域名解析系统DNS
   + 多层命名服务器构成的分布式数据库
     + 为什么不使用集中式的DNS？
       + 单点失败问题
       + 流量问题
       + 距离问题
       + 维护性问题
   + 应用层协议：完成名字的解析
     + Internet核心功能，用应用层协议实现
     + 网络边界复杂
3. DNS服务
   + 域名向IP地址翻译
   + 主机别名
   + 邮件服务器别名
   + 负载均衡：Web服务器



**域名系统DNS是因特网使用的命名系统，用来把便于人们使用的机器名字换换位IP地址。**

1. 为什么机器在处理IP数据报的时候要使用IP地址而不使用域名呢？
   + 因为ip地址的长度固定是32位（如果是IPv6是128位，是定长的）而域名的长度不是固定的，机器处理起来比较困难。
2. 因特网的域名系统DNS被设计成一个联机分布式的数据库系统，并采用客户服务器方式。DNS使大多数名字都在本地解析，仅少量解析需要在因特网上通信。
3. 域名到IP地址的解析是由分布在因特网上的许多域名服务器程序（也成域名服务器）共同完成的。

##### 因特网的域名结构

1. 因特网采用层次树状结构的 命名方法，采用这种命名方法，任何一个连接在因特网上的主机或者路由器，都有一个唯一的层次结构的名字。

   + 域指的是名字空间中一个可以被管理的划分。域还可以划分为子域，而子域还可以划分为子域的子域，这样就形成了顶级域、二级域、三级域等等。
   + 从语法上讲，每一个域名都是由标号label序列组成，而各标号之间用点隔开。
     + mail(三级域名).cctv(二级域名).com(顶级域名)
   + DNS规定，域名中的标号由英文字母和数字组成，每一个标号不超过36个字符（最好不要超过12个字符），也不区分大小写字母，标号中除了连字符(-)之外不能使用其他的标点符号。级别最低的域名写在最左边，而级别最高的域名则写在最右边。由多个标号组成的完整域名不超过255个字符。

2. 域名

   + 国家顶级域名nTLD：采用ISO3166的规定。如cn表示中国，us表示美国
   + 通用顶级域名gTLD：com 公司企业，net网络服务机构 ，org非营利性的组织 int国际组织
   + 基础结构域名：只有一个，即arpa，用于反向域名解析。
   + **在国家顶级域名下注册的二级域名由该国家自行确定，我国修订的域名体系允许直接在cn的顶级域名下注册二级域名**。

   ![域名空间](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/域名空间.png)

##### 域名服务器

**具体实现域名系统则是使用分布在各地的域名服务器**

1. DNS采用划分区的办法来解决这个问题。

   + 一个服务器所管辖的范围叫做区。在一个区中所有的节点必须是能够连通的，每一个区中设置相应的权限域名服务器，用来保存该区中所有主机域名到IP地址的映射。区可能等于小于域，但不能大于域。

   ![DNS划分区](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/域名划分区.jpg)

   ![树状结构的DNS域名服务器](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/树状结构的DNS域名服务器.jpg)

   + 上图中，因特网中的域名服务器是按层次安排的，每一个域名服务器都只对域名体系中的一部分进行管辖。当某个DNS服务器不能进行域名到IP地址的转换时，就设法找因特网上别的域名服务器进行解析。

2. 根据域名服务器所起的作用不同，可以把域名服务器划分为以下四种不同的类型：

   + 根域名服务器
     + 最高层次的域名服务器，也是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和IP地址。无论是哪一个本地域名服务器，若要对因特网上的任何一个域名进行解析，只要自己无法解析，就首先要求助于根域名服务器。
     + 需要注意的是，很多情况下，根域名服务器并不直接把带查询的域名直接转换成IP地址，而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询。
   + 顶级域名服务器
     + 顶级域名服务器负责管理在该顶级域名服务器注册的所有二级域名。当收到DNS请求时，给出相应的回答，最后的结果也可能是下一步要找的域名服务器的ip地址。
   + 权限域名服务器
     + 负责一个区的域名服务器。当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的DNS客户，下一步应当找哪一个权限域名服务器。
   + **本地域名服务器**
     + 本地域名服务器不属于上图的域名服务器的层析结构，但是对域名系统非常重要，当一个主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器。
       + 每一个ISP有一个本地域名服务器，默认域名解析服务器。
     + 当主机进行DNS查询时，查询被发送到本地域名服务器
       + 作为代理（Proxy），将查询转发给（层级式）域名解析服务器系统。

##### 域名的解析过程

1. 主机向本地域名服务器的查询一般是采用**递归查询**

   + 所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其他根域名服务器继续发出查询请求报文（即替该主机继续查询），而不是让该主机进行下一步的查询。因此，递归查询返回的查询结果要么是所查询的IP地址，或者是报错表示无法查询的所需的IP地址。

2. 本地域名服务器向根域名服务器的查询通常是采用**迭代查询**

   + 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器：你下一步应当向哪一个域名服务器进行查询。然后让本地域名服务器进行查询。根域名服务器一般是把自己知道的顶级域名服务器的Ip地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器进行查询。顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的ip地址，要么告诉本地域名服务器下一步应当向哪一个权限域名服务器进行查询，本地域名服务器就这样进行迭代查询。当然，本地域名服务器也可以采用递归查询，这取决于最初的查询请求报文的设置要求使用哪一种查询方式。

3. 过程：

   1. 主机m..xyz.com先向其本地域名服务器dns.xyz.com进行查询
   2. 本地域名服务器采用迭代查询。它先向一个根域名服务器查询。
   3. 根域名服务器告诉本地域名服务器，下一次应该查询的顶级域名服务器dns.com的IP地址。
   4. 本地域名服务器向向顶级域名服务器dns.com进行查询。
   5. 顶级域名服务器告诉本地域名服务器。下一次查询的权限域名服务器的dns.abc.com的IP地址
   6. 本地域名服务器向权限域名服务器dns.abc.com进行查询。
   7. 权限域名服务器dns.abc.com告诉本地域名服务器，所查询的主机的IP地址。
   8. 本地域名服务器最后把查询结果告诉主机的IP地址。

   ![DNS解析过程](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/dns查询过程.png)