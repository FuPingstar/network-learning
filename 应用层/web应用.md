# Web与Http



## 万维网（World Wide Web）

### 什么是万维网

+ 万维网是一个大规模的、联机式的信息储藏所。万维网能用链接的方法非常方便的从因特网上的一个站点访问另外一个站点，从而主动获取丰富的信息。

![万维网](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/万维网.png)

+ 万维网是一个分布式的**超媒体系统**，是超文本系统的扩充。所谓超文本是包含指向其他文档的链接的文本。超文本是万维网的基础。

  + **超文本与超媒体的区别是文档内容不同**。超文本是文档仅包含文本信息，而超媒体文档还包含其他表示方式的信息，如图形、图像、声音、动画，甚至还包含活动视频图像等。

  + **分布式和非分布式的超媒体系统有很大区别**。非分布式系统中，各种信息都驻留在单个计算机的磁盘中，由于各种信息驻留在单个计算机的磁盘中。由于各种文档都可从本地获得，因此这些文档之间的链接可进行一致性检查。所以，**一个非分布式超媒体系统能够保证所有的链接都是有效的和一致的**。万维网把大量信息分布在整个因特网上。每台主机的独立进行管理。对这些文档的增加，删除，或重新命名都不需要（也不可能）通知到因特网上成千上万的节点，这样，**万维网文档之间的链接经常就会不一致**。
  + 万维网以客户服务器方式工作。浏览器是用户主机上的万维网客户端程序。万维网文档所驻留的主机上则运行服务程序，因此这个主机也成为万维网服务器。**客户程序向服务器发出请求，服务程序向客户程序送回客户所要的万维网文档**。在一个客户程序主窗口显示出的万维网文档称为页面。

### 万维网必须要解决的问题

+ 怎样标志分布在整个因特网上的万维网文档
  + 统一资源定位符（URL）
+ 用什么协议来实现万维网上的各种链接
  + 超文本传送协议（HTTP）
+ 怎样使不同作者创作的不同风格的万维网文档都能在因特网的各种主机上显示出来，同时使用户清楚的知道在什么地方存在着链接。
  + 超文本标记语言（HTML）
+ 怎样使用户能够方便的找到所需的信息
  + 搜索工具

## WEB对象的寻址（URL、URI）

+ URL（Uniform Resource Locator）：统一资源定位器

  + **统一资源定位符URL是表示从因特网上得到的资源位置和访问这些资源的方法。URL给资源的位置提供一种抽象的识别方法，并用这种方法给资源定位。**只要能够对资源定位，系统就能够对资源进行各种操作，如存取，更新，替换和查找属性。
  + 资源是指在因特网上可以被访问的任何Web对象，包括文件目录，文件，文档，图像，声音等，以及与因特网相连的任何形式的数据。
  + URL相当于一个文件名在网络范围的扩展，因此，URL是与因特网相连的机器上的任何可以访问的对象的指针。
  + 格式：Schemal://host:port/path？query    <协议>://<主机>:<端口>/<路径>?<查询条件>
+ URI和URL的区别
  + URI是以一种高层次的、抽象的的概念定位统一资源标识符，而URL和URN则是具体的资源标识的方式。URL和URN是URI的一种。
  + URL是一种具体的URI，不仅唯一标识资源，而且还提供了定位该资源的信息。URI是一种语义上的抽象概念，可以是绝对的，也可以是相对的，而URL必须提供足够的信息来定位，所以URL绝对的。
  + URL：
    + Universal Resource Locator 统一资源定位符，一种定位资源的主要访问机制的字符串。
    + 标准格式：
      + 协议类型:**[**//服务器地址**[**:端口号**]][**/资源层级UNIX文件路径**]文件名[?**查询**][#**片段ID**][#**片段ID]
    + 完整格式
      + 协议类型:**[**//**[**访问资源需要的凭证信息@**]**服务器地址**[**:端口号**]][**/资源层级UNIX文件路径**]文件名[?**查询**][#**片段ID]
    + 超文本传输协议的统一资源定位符将从因特网获取信息的五个基本元素在一个简答的地址中：
      + 传送协议
      + 层级URL标记符号（//，固定不变）
      + 服务器（通常为域名，有时候为IP地址）
      + 端口号（以数字方式表达，若为默认值可以省略）
      + 路径（以 “/”字符区别路径中的每一个目录名称）
      + 查询（GET/POST）
      + 片段（以#字符为起点）
    + ex： http:  {协议}  // {层级URL标记符号} zh.wikipedia.org/w/index.php {路径} ?title=Special:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2 {查询}
    + 统一资源定位符不但被用作网页地址，JDBC客户端也使用统一资源定位符连接其数据库服务器。
  + URI
    + Universal Resource Idetifier 统一资源标识符，用来标识抽象或者物理资源的一个紧凑字符串
    + 与URL和URN的关系
      + URI可被视为定位符（URL），名称（URN）或两者兼备。统一资源名称（URN）如同一个人的名称，而统一资源定位符（URL）代表一个人的住址。换言之，URN定义某事物的身份，而URL提供查找该事物的方法。
      + 技术观点：URL是一种URI，它标识一个互联网资源，并指定对其进行操作或获取该资源的方法。可能通过对主要访问手段的描述，也可能通过网络“位置”进行标识。例如，http://www.wikipedia.org/这个URL，标识一个特定资源（首页）并表示该资源的某种形式（例如以编码字符)表示的，首页的HTML代码是可以通过HTTP协议从www.wikipedia.org这个网络主机获得的。URN是基于某名字空间通过名称指定资源的URI。人们可以通过URN来指出某个资源，而无需指出其位置和获得方式。资源无需是基于互联网的。例如，URN <urn:ISBN> 0-395-36341-1 指定标识系统（即国际标准书号ISBN）和某资源在该系统中的唯一表示的URI。它可以允许人们在不指出其位置和获得方式的情况下谈论这本书。

## HTTP协议--超文本传输协议（HyperText Transfer Protocol）

### C/S结构

+ 客户端：--Browser:请求，接收，展示web对象

+ 服务器端：--WebServer:响应客户请求，发送对象

### 使用TCP传输服务

+ 服务器在80端口等待客户的请求，不断监听端口80
+ 浏览器发起到服务器的TCP连接（创建套接字socket）
+ 服务器接收来自浏览器的TCP连接
+ 浏览器（HTTP客户端）与Web服务器（HTTP服务器交换HTTP 消息）
+ 关闭TCP连接

### 无状态协议（stateless）

+ 服务器不维护任何有关客户端过去所发请求的所有消息

### Http的两种连接类型

#### 非持久性连接(HTTP1.0)

+ 每个TCP连接最多允许传输一个对象
+ HTTP1.0使用非持久性连接
+ RTT （ROUND Trip Time）：从客户端发送一个很小的数据包到服务器并返回所经历的时间。
+ 响应时间：
  + 发起，建立一个TCP连接： 1个RTT
  + 发送HTTP请求消息到HTTP响应消息的前几个字节到达：1个RTT
  + 响应对象中的所含文件/对象的传输时间
+ TOTAL = 2RTT+文件发送时间
+ 非持久性连接的问题：
  + 每个对象需要两个RTT以上的时间才能获得
  + 操作系统要为每个TCP连接开销资源,万维网服务器同时要服务于大量客户的请求，这样会使万维网服务的负担变重。
  + 浏览器会怎么做？
    + 打开多个并行的TCP连接以获取网络所需的对象，浏览器都提供了5 ~10个并行的TCP连接，使用并行TCP连接会缩短响应时间。

#### 持久性连接(HTTP1.1)

+ 发送响应后，服务器保持TCP连接的打开，使得同一个客户端和服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。
+ 分类
  + 无流水的持久性连接连接
    + 客户端只有收到前一个响应才能发送新的请求
    + 每个被引用的对象耗时一个RTT。
    + 这比非持久性连接的两倍RTT开销时间节省了建立TCP连接所需要的一个RTT时间。
    + 缺点：在服务器发送完一个对象后，其TCP连接就处于空闲状态，浪费了服务器资源。
  + 带有流水机制的持久性连接
    + HTTP1.1默认选项
    + 客户端只要遇到一个引用对象就尽快发出请求
    + 理想情况下，所有的引用对象只耗时约一个RTT

### HTTP报文格式

#### HTTP协议两类报文

http请求报文和响应报文都是由三个部分组成，这两种报文的格式的区别就是开始行不同

- 开始行：**用于区分是请求报文还是响应报文**。在请求报文中，开始行叫做请求行（Request Line），在响应报文中，开始行叫做状态行（Status Line）。
- 首部行：**用来说明浏览器、服务器或者报文主体的一些信息**。
- 实体主体：**在请求报文中一般不用这个字段，而在响应报文中也可能没有这个字段**。

##### 请求报文：从客户端向服务器发送请求报文

![http请求消息通用格式](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/http请求报文通用格式.png)

![http请求报文举例](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/http请求报文举例.png)

+ 请求报文的第一行 “请求行”只有三个内容，方法，请求资源的URL，以及HTTP的版本。

  这里重点说一下方法，方法就是对所请求的对象进行的操作。下面列出请求报文常用的几种方法：

  + OPTION：请求一些选项的信息
  + GET：请求读取URL所标志的信息
  + HEAD：请求读取由URL所标志的信息的首部
  + POST：给服务器添加信息
  + PUT：在指明的URL存储一个文档
  + DELETE：删除指明的URL所标志的资源
  + TRACE：用来进行环回测试的请求报文
  + CONNECT：用于代理服务器

##### 响应报文

![http响应报文举例](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/http响应报文举例.png)

+ 响应报文的第一行是状态行，状态行包含三项内容：HTTP版本，状态码，解释状态码的简单短语。

+ http 响应状态码
  + 分为5大类
    + 1XX ： 表示通知信息的，如请求收到了或者正在进行处理。
    + 2XX：表示成功，如接受或者知道了。
    + 3XX：表示重定向，如要完成请求还必须采取进一步的行动。
    + 4XX：表示客户的差错，如请求中有错误的语法或不能完成。
    + 5XX：表示服务器的差错，如服务器失效无法完成请求。
+ 体验HTTP（telnet  后续学习）

#### [http报文字段详解](<https://juejin.im/post/5a5cab18f265da3e46750ee2>)

### Cookie技术

+ cookie技术是某些网站为了辨别用户身份、进行session跟踪而存储在用户本地终端的数据（通过加密）。
+ Cookie的组件
  + HTTP响应消息的cookie头部行
  + HTTP请求消息的cookie头部行
  + 保存在客户端主机上的cookie文件，由浏览器管理
  + Web服务器端的后台数据库
+ cookie原理

![cookie原理](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/cookie原理.png)

## Web缓存/代理服务器技术

   **代理服务器是一种网络实体，又称为万维网高速缓存（Web Cache）。代理服务器把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按URl的地址再次去因特网访问该资源。代理服务器可在客户端或服务器端工作，也可在中间系统上工作。**

   + 功能：在不访问服务器的前提下满足http请求

   + 性能提升：

     + 缩短客户请求的响应时间
     + 减少机构/组织的流量
     + 在大范围内实现有效的内容分发

   + 过程:

     + 用户设定浏览器通过缓存进行web访问
     + 浏览器向缓存/代理服务器发送所有的HTTP请求
       + 如果请求对象在缓存中，缓存返回对象。
       + 否则，缓存服务器向原始服务器发送HTTP请求，获取对象，**然后返回给客户端并保存该对象**
     + 缓存既充当客户端又充当服务器

     ![缓存](https://own-pic-bed.oss-cn-beijing.aliyuncs.com/缓存.png)







